# 1. Берем чистый n8n
FROM n8nio/n8n:latest

# 2. Переключаемся на root, чтобы получить все права
USER root

# 3. Устанавливаем рабочую папку, где n8n ГАРАНТИРОВАННО ищет кастомные ноды
WORKDIR /home/node/.n8n

# 4. Используем стандартную команду npm для установки пакета прямо из GitHub.
# Это самый надежный и правильный способ для такой ситуации.
RUN npm install git+https://github.com/tavily-ai/tavily-n8n-node.git

# 5. Делаем пользователя 'node' владельцем всех установленных файлов,
# чтобы n8n мог их читать.
RUN chown -R node:node /home/node/.n8n

# 6. Возвращаемся к безопасному пользователю для запуска n8n
USER node
